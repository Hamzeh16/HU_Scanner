@model IEnumerable<ScannerModels.Model.ApplicationUser>
@{
    ViewData["Title"] = "Reset User Passwords";
}

<style>
    body {
        background-color: #f8f9fa;
        font-family: "Segoe UI", Arial, sans-serif;
    }

    .page-header {
        background: linear-gradient(90deg, #dc3545 0%, #b02a37 100%);
        color: #fff;
        padding: 25px 20px;
        border-radius: 12px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        margin-bottom: 35px;
        text-align: center;
    }

        .page-header h2 {
            font-weight: 700;
            margin: 0;
        }

    .table {
        background: #fff;
        border-radius: 10px;
        overflow: hidden;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
        width: 100%;
    }

    thead.table-danger th {
        color: #fff;
        background-color: #dc3545;
        border: none;
        text-align: center;
    }

    td, th {
        vertical-align: middle;
        text-align: center;
    }

    .btn-reset {
        background-color: #fff;
        border: 2px solid #dc3545;
        color: #dc3545;
        font-weight: 600;
        border-radius: 6px;
        padding: 5px 12px;
        transition: 0.2s ease;
    }

        .btn-reset:hover {
            background-color: #dc3545;
            color: #fff;
            transform: translateY(-2px);
        }

    .reset-section {
        display: none;
        background-color: #fff;
        border: 2px solid #dc3545;
        border-radius: 10px;
        padding: 20px;
        margin-top: 30px;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
    }

        .reset-section h5 {
            color: #b02a37;
            font-weight: 700;
            margin-bottom: 20px;
        }

    .alert {
        border-left: 4px solid #dc3545;
    }

    .btn-primary {
        background-color: #dc3545;
        border: none;
    }

        .btn-primary:hover {
            background-color: #b02a37;
        }

    .btn-cancel {
        border: 2px solid #6c757d;
        background: none;
        color: #6c757d;
        font-weight: 600;
        border-radius: 6px;
        padding: 5px 12px;
        transition: 0.2s ease;
    }

        .btn-cancel:hover {
            background-color: #6c757d;
            color: #fff;
        }
</style>

<div class="page-header">
    <h2>🔐 Reset User Passwords</h2>
    <p class="mb-0">Select a user to securely reset their password</p>
</div>

@if (TempData["msg"] != null)
{
    <div class="alert alert-info mx-3">@TempData["msg"]</div>
}

<div class="container">
    <table class="table table-bordered table-striped align-middle">
        <thead class="table-danger">
            <tr>
                <th>#</th>
                <th>Name</th>
                <th>Email / Username</th>
                <th>Role</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            @{
                int i = 1;
            }
            @foreach (var user in Model)
            {
                <tr>
                    <td>@i</td>
                    <td>@($"{user.FirstName} {user.LastName}")</td>
                    <td>@user.Email</td>
                    <td>
                        <span class="badge bg-danger-subtle text-danger border border-danger px-3 py-2">
                            @user.TypeUser
                        </span>
                    </td>
                    <td>
                        <button class="btn-reset" onclick="showResetForm('@user.Id', '@user.FirstName', '@user.LastName')">
                            <i class="bi bi-key"></i> Reset Password
                        </button>
                    </td>
                </tr>
                i++;
            }
        </tbody>
    </table>

    <!-- Hidden Reset Section -->
    <div id="resetSection" class="reset-section">
        <h5><i class="bi bi-lock"></i> Reset Password for <span id="selectedUserName" class="text-danger"></span></h5>
        <form asp-area="Dean" asp-controller="Users" asp-action="ResetPassword" method="post">
            <input type="hidden" id="UserId" name="userId" />
            <div class="row mb-3">
                <div class="col-md-6">
                    <label class="form-label fw-semibold">New Password</label>
                    <input type="password" class="form-control" name="newPassword" required />
                </div>
                <div class="col-md-6">
                    <label class="form-label fw-semibold">Confirm Password</label>
                    <input type="password" class="form-control" id="confirmPassword" required />
                    <div id="passwordError" class="text-danger small mt-1" style="display:none;">
                        Passwords do not match.
                    </div>
                </div>
            </div>
            <div class="d-flex justify-content-end gap-2">
                <button type="button" class="btn-cancel" onclick="hideResetForm()">Cancel</button>
                <button type="submit" id="submitReset" class="btn btn-primary">Reset</button>
            </div>
        </form>
    </div>
</div>


<script>
    window.showResetForm = function(id, firstName, lastName) {
        const panel = document.getElementById("resetSection");
        if (!panel) return;
        panel.style.display = "block";
        document.getElementById("selectedUserName").innerText = firstName + " " + lastName;
        document.getElementById("UserId").value = id;
        document.getElementById("passwordError").style.display = "none";
        document.getElementById("confirmPassword").value = "";
        window.scrollTo({ top: document.body.scrollHeight, behavior: 'smooth' });
    };

    window.hideResetForm = function() {
        const panel = document.getElementById("resetSection");
        if (panel) panel.style.display = "none";
    };

    document.addEventListener('DOMContentLoaded', function() {
        const confirm = document.getElementById('confirmPassword');
        const submit = document.getElementById('submitReset');
        const error = document.getElementById('passwordError');
        const newPwd = document.querySelector('input[name="newPassword"]');

        if (!confirm || !newPwd) return;

        const validate = () => {
            if (newPwd.value !== confirm.value) {
                error.style.display = 'block';
                submit.disabled = true;
            } else {
                error.style.display = 'none';
                submit.disabled = false;
            }
        };

        confirm.addEventListener('input', validate);
        newPwd.addEventListener('input', validate);
    });
</script>


